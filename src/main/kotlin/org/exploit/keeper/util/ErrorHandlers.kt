package org.exploit.keeper.util

import org.exploit.keeper.constant.crypto.ErrorCode
import org.exploit.keeper.constant.crypto.SessionType
import org.exploit.keeper.model.event.SessionFailedEvent
import org.exploit.signalix.manager.EventScope
import org.exploit.tss.exception.IdentifiableAbortException

object ErrorHandlers {
    fun handleAbort(sessionId: String, type: SessionType, eventScope: EventScope, t: Throwable) {
        val (code, culprit) = if (t is IdentifiableAbortException)
            ErrorCode.INTRUSION to t.peerId
        else
            ErrorCode.OTHER to null

        eventScope.call(SessionFailedEvent(
            code = code,
            sessionId = sessionId,
            type = type,
            reason = t.message ?: "Unknown",
            culprit = culprit,
        ))
    }
}