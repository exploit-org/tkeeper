package org.exploit.keeper.util.future

import java.util.concurrent.CompletableFuture
import java.util.concurrent.atomic.AtomicReference

class MemoFuture<T>(private val supplier: () -> CompletableFuture<T>) {
    private val ref = AtomicReference<CompletableFuture<T>?>()

    fun get(): CompletableFuture<T> {
        val ex = ref.get()
        if (ex != null) return ex

        val created = supplier()
        return if (ref.compareAndSet(null, created)) {
            created
        } else {
            ref.get()!!
        }
    }
}