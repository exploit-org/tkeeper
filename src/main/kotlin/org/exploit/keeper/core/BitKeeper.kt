package org.exploit.keeper.core

import io.quarkus.runtime.Quarkus
import io.quarkus.runtime.QuarkusApplication
import io.quarkus.runtime.annotations.QuarkusMain
import jakarta.inject.Inject
import jakarta.inject.Singleton
import org.exploit.keeper.core.cli.CliCommand
import org.exploit.keeper.db.LMKDB
import picocli.CommandLine

@QuarkusMain
@Singleton
class BitKeeper : QuarkusApplication {
    @Inject
    lateinit var db: LMKDB

    override fun run(vararg args: String): Int {
        val profile = System.getProperty("quarkus.profile")

        if (profile == "cli")
            return CommandLine(CliCommand(db)).execute(*args)

        Quarkus.waitForExit()
        return 0
    }
}