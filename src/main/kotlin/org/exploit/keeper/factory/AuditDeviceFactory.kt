package org.exploit.keeper.factory

import io.micronaut.context.annotation.Factory
import jakarta.inject.Singleton
import org.exploit.keeper.config.keeper.KeeperConfig
import org.exploit.keeper.service.audit.device.AuditDevice
import org.exploit.keeper.service.audit.device.file.FileAuditDevice
import org.exploit.keeper.service.audit.device.socket.SocketAuditDevice

@Factory
class AuditDeviceFactory(private val config: KeeperConfig) {
    @Singleton
    fun devices(): List<AuditDevice> {
        val auditConfig = config.audit
        val devices = mutableListOf<AuditDevice>()

        auditConfig.file?.let {
            devices.add(FileAuditDevice(it))
        }

        auditConfig.socket?.let {
            devices.add(SocketAuditDevice(it))
        }

        return devices
    }
}