package org.exploit.keeper.factory

import io.micronaut.context.annotation.Factory
import jakarta.inject.Singleton
import org.exploit.sodium.ReadOnlyBuffer
import org.exploit.sodium.Sodium
import java.security.SecureRandom

@Factory
class MemoryKeyFactory {
    @Singleton
    fun inMemoryKey(): ReadOnlyBuffer {
        val buf = ByteArray(KEY_SIZE)
        RANDOM.nextBytes(buf)

        return ReadOnlyBuffer(buf)
    }

    private companion object {
        init {
            Sodium.INSTANCE.sodium_init()
        }

        val RANDOM: SecureRandom = SecureRandom.getInstanceStrong()
        const val KEY_SIZE = 32
    }
}