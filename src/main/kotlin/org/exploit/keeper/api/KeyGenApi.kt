package org.exploit.keeper.api

import org.eclipse.jetty.http.HttpMethod
import org.exploit.jettyx.annotation.Body
import org.exploit.jettyx.annotation.HttpRequest
import org.exploit.jettyx.annotation.Query
import org.exploit.jettyx.model.HttpResponse
import org.exploit.keeper.model.key.KeyVersion
import org.exploit.keeper.model.keygen.InitKeyGen
import org.exploit.keeper.model.keygen.ShamirShareDto
import java.util.concurrent.CompletableFuture

interface KeyGenApi {
    @HttpRequest(path = "/v1/keygen/init", method = HttpMethod.POST)
    fun init(@Body init: InitKeyGen): CompletableFuture<HttpResponse<Void>>

    @HttpRequest(path = "/v1/keygen/share", method = HttpMethod.GET)
    fun share(@Query("keyId") keyId: String): CompletableFuture<HttpResponse<ShamirShareDto>>
    
    @HttpRequest(path = "/v1/keygen/collect", method = HttpMethod.POST)
    fun collect(@Query("keyId") keyId: String): CompletableFuture<HttpResponse<Void>>

    @HttpRequest(path = "/v1/keygen/compute", method = HttpMethod.POST)
    fun compute(@Query("keyId") keyId: String): CompletableFuture<HttpResponse<Void>>

    @HttpRequest(path = "/v1/keygen/abort", method = HttpMethod.POST)
    fun abort(@Query("keyId") keyId: String, @Query("generation") gen: Int? = null): CompletableFuture<HttpResponse<Void>>

    @HttpRequest(path = "/v1/keygen/complete", method = HttpMethod.POST)
    fun complete(@Query("keyId") keyId: String): CompletableFuture<HttpResponse<Void>>

    @HttpRequest(path = "/v1/keygen/version", method = HttpMethod.GET)
    fun version(@Query("keyId") keyId: String): CompletableFuture<HttpResponse<KeyVersion>>

    @HttpRequest(path = "/v1/keygen/dropPending", method =HttpMethod.POST)
    fun dropPending(
        @Query("keyId") keyId: String,
        @Query("generation") generation: Int
    ): CompletableFuture<HttpResponse<Void>>

    @HttpRequest(path = "/v1/keygen/sync", method = HttpMethod.POST)
    fun sync(@Query("keyId") keyId: String, @Query("generation") generation: Int): CompletableFuture<HttpResponse<Void>>

    @HttpRequest(path = "/v1/keygen/session/abort", method = HttpMethod.POST)
    fun abortSession(@Query("keyId") keyId: String): CompletableFuture<HttpResponse<Void>>
}