package org.exploit.keeper.service.audit.device.file.compress

import java.io.IOException
import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.StandardOpenOption
import java.util.zip.GZIPOutputStream

object GZIPCompressor : Compressor {
    override fun compress(src: Path): Path {
        val target = src.resolveSibling(src.fileName.toString() + ".gz")

        try {
            Files.newInputStream(src, StandardOpenOption.READ).use { inp ->
                Files.newOutputStream(target, StandardOpenOption.CREATE, StandardOpenOption.TRUNCATE_EXISTING).use { out ->
                    GZIPOutputStream(out).use { gz ->
                        inp.copyTo(gz)
                        gz.flush()
                    }
                }
            }

            Files.deleteIfExists(src)
        } catch (e: IOException) {
            return src
        }

        return target
    }
}