package org.exploit.keeper.service.core

import jakarta.inject.Singleton
import org.exploit.keeper.db.RocksKeyDB
import org.exploit.keeper.model.RawPublicKeyDto
import org.slf4j.Logger
import org.slf4j.LoggerFactory

@Singleton
class KeeperIntegrityService(
    private val db: RocksKeyDB,
    private val keeper: KeeperInitService
) {
    private companion object {
        val LOGGER: Logger = LoggerFactory.getLogger(KeeperIntegrityService::class.java)
    }

    fun integrityKey(): RawPublicKeyDto {
        keeper.ensureReady()

        LOGGER.info("Providing integrity public key")
        return RawPublicKeyDto(db.readIntegrityPublicKey().encoded())
    }

    fun regenerateIntegrityKey() {
        keeper.ensureReady()

        db.writeIntegrityKey()
    }
}