package org.exploit.keeper.service.core

import jakarta.inject.Singleton
import org.exploit.keeper.db.RocksKeyDB
import org.exploit.keeper.extension.toBase64
import org.exploit.keeper.model.PublicKeyDto

@Singleton
class KeeperIntegrityService(
    private val db: RocksKeyDB,
    private val keeper: KeeperInitService
) {
    fun integrityKey(): PublicKeyDto {
        keeper.ensureReady()

        return PublicKeyDto(db.getIntegrityKey().encoded().toBase64())
    }

    fun regenerateIntegrityKey() {
        keeper.ensureReady()

        db.writeIntegrityKey()
    }
}