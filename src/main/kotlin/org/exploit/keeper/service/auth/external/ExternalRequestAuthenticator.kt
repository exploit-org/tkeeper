package org.exploit.keeper.service.auth.external

import org.exploit.keeper.model.auth.AuthData
import org.exploit.keeper.model.auth.plane.ControlPlaneAuthConfig
import org.exploit.keeper.util.path.AntPathMatcher

interface ExternalRequestAuthenticator {
    val type: String

    fun controlPlane(): ControlPlaneAuthConfig

    fun shouldSkip(path: String): Boolean {
        return IGNORE_PATHS.any { matcher -> matcher.matches(path) }
    }

    fun authenticate(token: String): AuthData

    companion object {
        val IGNORE_PATHS = listOf(
            AntPathMatcher.of("/ui/**"),
            AntPathMatcher.of("/v1/keeper/control/auth/config"),
            AntPathMatcher.of("/v1/keeper/ping"),
            AntPathMatcher.of("/v1/keeper/system/health"),
            AntPathMatcher.of("/v1/keeper/system/ready")
        )
    }
}