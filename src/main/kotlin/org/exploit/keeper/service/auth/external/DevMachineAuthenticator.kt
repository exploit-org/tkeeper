package org.exploit.keeper.service.auth.external

import org.exploit.keeper.config.dev.DevConfig
import org.exploit.keeper.constant.common.ErrorType
import org.exploit.keeper.exception.TKeeperException
import org.exploit.keeper.model.auth.AuthData
import org.exploit.keeper.model.auth.SimpleAuthData

class DevMachineAuthenticator(private val devConfig: DevConfig) : ExternalRequestAuthenticator {
    override fun authenticate(token: String): AuthData {
        val devToken = devConfig.token

        if (devToken.isBlank() || token != devToken)
            throw TKeeperException(ErrorType.DEV_MODE_VIOLATION, "Invalid dev mode token")

        return SimpleAuthData(SUBJECT, devConfig.permissions)
    }

    companion object {
        const val ID = "dev"
        const val SUBJECT = "dev-mode"
    }
}