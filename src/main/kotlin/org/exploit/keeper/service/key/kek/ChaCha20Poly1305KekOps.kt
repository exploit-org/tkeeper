package org.exploit.keeper.service.key.kek

import org.exploit.sodium.ReadOnlyBuffer
import org.exploit.sodium.cipher.ChaCha20Poly1305Cipher
import javax.security.auth.Destroyable

class ChaCha20Poly1305KekOps(private val key: ReadOnlyBuffer): KekOps, Destroyable {
    override fun wrapDek(dek: ByteArray): ByteArray {
        return key.read {
            ChaCha20Poly1305Cipher.getInstance().encrypt(dek, ByteArray(0), it)
        }
    }

    override fun unwrapDek(wrappedDek: ByteArray): ByteArray {
        return key.read {
            ChaCha20Poly1305Cipher.getInstance().decrypt(wrappedDek, ByteArray(0), it)
        }
    }

    override fun destroy() {
        key.close()
    }
}