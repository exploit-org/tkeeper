package org.exploit.keeper.producer

import jakarta.enterprise.inject.Produces
import jakarta.inject.Singleton
import org.exploit.sodium.ReadOnlyBuffer
import org.exploit.sodium.Sodium
import java.security.SecureRandom

@Singleton
class MemoryKeyProducer {
    @Produces
    fun inMemoryKey(): ReadOnlyBuffer {
        val buf = ByteArray(KEY_SIZE)
        RANDOM.nextBytes(buf)

        return ReadOnlyBuffer(buf)
    }

    private companion object {
        init {
            Sodium.INSTANCE.sodium_init()
        }

        val RANDOM: SecureRandom = SecureRandom.getInstanceStrong()
        const val KEY_SIZE = 32
    }
}