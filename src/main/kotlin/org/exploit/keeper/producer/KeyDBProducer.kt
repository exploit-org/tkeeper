package org.exploit.keeper.producer

import io.quarkus.runtime.Startup
import jakarta.enterprise.inject.Produces
import jakarta.inject.Singleton
import org.exploit.keeper.config.KeeperConfig
import org.exploit.keeper.db.RocksKeyDB
import org.exploit.keeper.service.seal.provider.SealProvider

@Startup
@Singleton
class KeyDBProducer(private val config: KeeperConfig, private val provider: SealProvider) {
    @Produces
    @Singleton
    @Startup
    fun keyDb(): RocksKeyDB {
        return RocksKeyDB(config.databasePath()) { provider.keyOpsOrThrow() }
    }
}