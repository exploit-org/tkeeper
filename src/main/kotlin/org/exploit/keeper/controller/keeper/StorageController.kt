package org.exploit.keeper.controller.keeper

import jakarta.ws.rs.Path
import jakarta.ws.rs.container.ContainerRequestContext
import org.exploit.keeper.constant.Permission
import org.exploit.keeper.model.request.Store
import org.exploit.keeper.service.auth.policy.MachinePolicyChecker
import org.exploit.keeper.service.core.KeeperStorageService
import org.jboss.resteasy.reactive.ResponseStatus

@Path("/v1/keeper/storage")
class StorageController(
    private val ctx: ContainerRequestContext,
    private val policyChecker: MachinePolicyChecker,
    private val storage: KeeperStorageService
) {
    @Path("/store")
    @ResponseStatus(204)
    fun store(body: Store) {
        policyChecker.ensureHasPermission(ctx, Permission.storageWrite())
        storage.store(body)
    }
}