package org.exploit.keeper.controller.keeper

import jakarta.ws.rs.POST
import jakarta.ws.rs.Path
import jakarta.ws.rs.container.ContainerRequestContext
import org.exploit.keeper.constant.Permission
import org.exploit.keeper.service.auth.policy.MachinePolicyChecker
import org.exploit.keeper.service.core.KeeperIntegrityService

@Path("/v1/keeper/integrity")
class IntegrityController(
    private val ctx: ContainerRequestContext,
    private val policyChecker: MachinePolicyChecker,
    private val integrity: KeeperIntegrityService
) {
    @POST
    @Path("/regen")
    fun regenerate() {
        policyChecker.ensureHasPermission(ctx, Permission.integrityRegen())
        integrity.regenerateIntegrityKey()
    }
}