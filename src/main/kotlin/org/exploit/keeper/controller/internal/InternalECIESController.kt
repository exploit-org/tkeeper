package org.exploit.keeper.controller.internal

import com.linecorp.armeria.server.ServerBuilder
import jakarta.inject.Singleton
import org.exploit.keeper.controller.support.ControllerSupport
import org.exploit.keeper.model.ecies.PartialDecryptRequest
import org.exploit.keeper.service.ecies.ThresholdECIESManager

@Singleton
class InternalECIESController(
    private val support: ControllerSupport,
    private val manager: ThresholdECIESManager
) : InternalController {
    override fun register(sb: ServerBuilder) = with(support) {
        sb.internalPost("/v1/ecies/decrypt", PartialDecryptRequest::class.java) { _, body ->
            manager.partialDecrypt(
                keyId = body.keyId,
                cipherType = body.algorithm,
                ciphertext = body.ciphertext,
                participants = body.participants,
                generation = body.generation
            )
        }
    }
}