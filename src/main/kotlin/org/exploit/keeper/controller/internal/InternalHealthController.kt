package org.exploit.keeper.controller.internal

import com.linecorp.armeria.server.ServerBuilder
import jakarta.inject.Singleton
import org.exploit.keeper.controller.support.ControllerSupport
import org.exploit.keeper.model.health.ShortStatus
import org.exploit.keeper.service.core.KeeperInitService

@Singleton
class InternalHealthController(
    private val support: ControllerSupport,
    private val keeper: KeeperInitService
) : InternalController {
    override fun register(sb: ServerBuilder) = with(support) {
        sb.internalGet("/v1/health/status") { _ ->
            ShortStatus(ready = keeper.initialized() && !keeper.sealed())
        }
    }
}