package org.exploit.keeper.model.signature

import org.exploit.keeper.constant.common.ErrorType
import org.exploit.keeper.constant.crypto.ContextKind
import org.exploit.keeper.exception.TKeeperException
import org.exploit.keeper.extension.crypto.decodeBase64OrNull

class TaprootContext(val merkleRoot64: String?) : SignatureContext {
    override val kind: ContextKind = ContextKind.TAPROOT

    override fun validate() {
        if (merkleRoot64 == null)
            return

        val decoded = merkleRoot64.decodeBase64OrNull()
            ?: throw TKeeperException(ErrorType.INVALID_MERKLE_ROOT)

        if (decoded.size != 32 && decoded.isNotEmpty())
            throw TKeeperException(ErrorType.INVALID_MERKLE_ROOT)
    }
}