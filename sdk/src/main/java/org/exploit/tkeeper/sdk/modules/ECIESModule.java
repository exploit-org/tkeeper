package org.exploit.tkeeper.sdk.modules;

import org.eclipse.jetty.http.HttpMethod;
import org.exploit.jettyx.Jettyx;
import org.exploit.jettyx.annotation.Body;
import org.exploit.jettyx.annotation.ContentType;
import org.exploit.jettyx.annotation.HttpRequest;
import org.exploit.jettyx.auth.Authorization;
import org.exploit.jettyx.model.HttpResponse;
import org.exploit.tkeeper.sdk.annotation.Description;
import org.exploit.tkeeper.sdk.model.Decrypt;
import org.exploit.tkeeper.sdk.model.Decrypted;
import org.exploit.tkeeper.sdk.model.Encrypt;
import org.exploit.tkeeper.sdk.model.Encrypted;

import static org.exploit.tkeeper.sdk.util.KeeperUtils.handleError;

public final class ECIESModule {
    private final ECIESApi api;

    private interface ECIESApi {
        @Description("Encrypt data using ECIES")
        @HttpRequest(method = HttpMethod.POST, path = "/v1/keeper/ecies/encrypt")
        @ContentType("application/json")
        HttpResponse<Encrypted> encrypt(@Body Encrypt request);

        @Description("Decrypt data using ECIES")
        @HttpRequest(method = HttpMethod.POST, path = "/v1/keeper/ecies/decrypt")
        @ContentType("application/json")
        HttpResponse<Decrypted> decrypt(@Body Decrypt request);
    }

    public ECIESModule(Jettyx jettyx, String baseUrl, Authorization auth) {
        this.api = jettyx.newApiClient(baseUrl, auth).create(ECIESApi.class);
    }

    public Encrypted encrypt(Encrypt request) {
        var resp = api.encrypt(request);
        handleError(resp);
        return resp.body();
    }

    public Decrypted decrypt(Decrypt request) {
        var resp = api.decrypt(request);
        handleError(resp);
        return resp.body();
    }
}