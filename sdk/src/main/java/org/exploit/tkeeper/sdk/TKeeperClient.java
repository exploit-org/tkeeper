package org.exploit.tkeeper.sdk;

import org.exploit.jettyx.Jettyx;
import org.exploit.jettyx.auth.Authorization;
import org.exploit.jettyx.auth.NoAuth;
import org.exploit.jettyx.http2.Http2Version;
import org.exploit.jettyx.jackson.JacksonHttpMapper;
import org.exploit.tkeeper.sdk.auth.DevTokenAuth;
import org.exploit.tkeeper.sdk.model.ExpireItem;
import org.exploit.tkeeper.sdk.modules.*;

import java.io.Closeable;

public final class TKeeperClient implements Closeable {
    private final Jettyx jettyx;

    private final IntegrityModule integrity;
    private final DestroyModule destroy;
    private final AuditModule audit;
    private final ConsistencyModule consistency;
    private final ComplianceModule compliance;
    private final SignatureModule signature;
    private final SystemModule system;
    private final CentralModule central;
    private final ControlPlaneModule controlPlane;
    private final StorageModule storage;
    private final ECIESModule ecies;
    private final DKGModule dkg;
    private final ExpireModule expire;

    public TKeeperClient(Jettyx jettyx, String baseUrl, Authorization authorization) {
        this.jettyx = jettyx;
        var auth = authorization != null ? authorization : new NoAuth();

        this.integrity = new IntegrityModule(jettyx, baseUrl, auth);
        this.destroy = new DestroyModule(jettyx, baseUrl, auth);
        this.audit = new AuditModule(jettyx, baseUrl, auth);
        this.consistency = new ConsistencyModule(jettyx, baseUrl, auth);
        this.compliance = new ComplianceModule(jettyx, baseUrl, auth);
        this.signature = new SignatureModule(jettyx, baseUrl, auth);
        this.system = new SystemModule(jettyx, baseUrl, auth);
        this.central = new CentralModule(jettyx, baseUrl, auth);
        this.controlPlane = new ControlPlaneModule(jettyx, baseUrl, auth);
        this.storage = new StorageModule(jettyx, baseUrl, auth);
        this.ecies = new ECIESModule(jettyx, baseUrl, auth);
        this.dkg = new DKGModule(jettyx, baseUrl, auth);
        this.expire = new ExpireModule(jettyx, baseUrl, auth);
    }

    public TKeeperClient(String baseUrl, Authorization authorization) {
        this(Jettyx.newBuilder().addHttpMapper(JacksonHttpMapper.create()).enableVersion(new Http2Version()).build(),
                baseUrl, authorization);
    }

    public TKeeperClient(String baseUrl, String devToken) {
        this(baseUrl, new DevTokenAuth(devToken));
    }

    public ExpireModule expire() {
        return expire;
    }

    public IntegrityModule integrity() {
        return integrity;
    }

    public DestroyModule destroy() {
        return destroy;
    }

    public AuditModule audit() {
        return audit;
    }

    public ConsistencyModule consistency() {
        return consistency;
    }

    public ComplianceModule compliance() {
        return compliance;
    }

    public SignatureModule signature() {
        return signature;
    }

    public SystemModule system() {
        return system;
    }

    public CentralModule central() {
        return central;
    }

    public ControlPlaneModule controlPlane() {
        return controlPlane;
    }

    public StorageModule storage() {
        return storage;
    }

    public ECIESModule ecies() {
        return ecies;
    }

    public DKGModule dkg() {
        return dkg;
    }

    public Jettyx getJettyx() {
        return jettyx;
    }

    @Override
    public void close() {
        jettyx.close();
    }
}